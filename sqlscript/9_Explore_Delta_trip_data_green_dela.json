{
	"name": "9_Explore_Delta_trip_data_green_dela",
	"properties": {
		"folder": {
			"name": "1_NYC_Taxi/1_Discovery"
		},
		"content": {
			"query": "-- This is auto-generated code\n-- Connect to Built in Serverless SQL Pool\n-- Connect to nyc_taxi_discovery Database\n\nUSE nyc_taxi_discovery\nGO\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'trip_data_green_delta/',\n        DATA_SOURCE = 'nyc_taxi_data_raw',\n        FORMAT = 'DELTA'\n    ) AS trip_data\n\n-- Reading Folder : It will give you an error . as Delta_Log folder is missing in the folder\n\nSELECT\n    TOP 100 * \nFROM\n    OPENROWSET(\n        BULK 'trip_data_green_parquet/year=2020/month=01/',\n        DATA_SOURCE = 'nyc_taxi_data_raw',\n        FORMAT = 'DELTA'\n    ) AS [result]\n\n--Check DataType\nEXEC sp_describe_first_result_set N'SELECT\n    TOP 100 * \nFROM\n    OPENROWSET(\n        BULK ''trip_data_green_delta/'',\n        DATA_SOURCE = ''nyc_taxi_data_raw'',\n        FORMAT = ''DELTA''\n    ) AS [result]'\n-------------------------------------------\n-- Define Columns and DataTypes\n-------------------------------------------\nSELECT\n    TOP 100 * \nFROM\n    OPENROWSET(\n        BULK 'trip_data_green_delta/',\n        DATA_SOURCE = 'nyc_taxi_data_raw',\n        FORMAT = 'DELTA'\n    ) WITH(\n\n    VendorID\tint\n    ,lpep_pickup_datetime\tdatetime2(7)\n    ,lpep_dropoff_datetime\tdatetime2(7)\n    ,store_and_fwd_flag\tCHAR(1)\n    ,RatecodeID\tint\n    ,PULocationID\tint\n    ,DOLocationID\tint\n    ,passenger_count\tint\n    ,trip_distance\tfloat\n    ,fare_amount\tfloat\n    ,extra\tfloat\n    ,mta_tax\tfloat\n    ,tip_amount\tfloat\n    ,tolls_amount\tfloat\n    ,ehail_fee\tint\n    ,improvement_surcharge\tfloat\n    ,total_amount\tfloat\n    ,payment_type\tint\n    ,trip_type\tint\n    ,congestion_surcharge\tfloat\n    ,year VARCHAR(4)\n    ,month VARCHAR(2)\n    ) AS [result]\n-------------------------------------------\n-- Read Specific Columns : Always Mention the Partition Columns in the WITH Clause. Here it is year & month\n-------------------------------------------\nSELECT\n    TOP 100 * \nFROM\n    OPENROWSET(\n        BULK 'trip_data_green_delta/',\n        DATA_SOURCE = 'nyc_taxi_data_raw',\n        FORMAT = 'DELTA'\n    )WITH(    \n     tip_amount\tfloat    \n    ,trip_type\tint\n    ,year VARCHAR(4)\n    ,month VARCHAR(2)\n    ) AS [result] \n\n-------------------------------------------\n-- !!!! No Partition Applied . so the dat read is more\n-------------------------------------------\n\n SELECT\n   COUNT(DISTINCT payment_type)\nFROM\n    OPENROWSET(\n        BULK 'trip_data_green_delta/',\n        DATA_SOURCE = 'nyc_taxi_data_raw',\n        FORMAT = 'DELTA'\n    )AS [result]    \n\n-------------------------------------------\n-- Apply the partition in WHERE clause\n-------------------------------------------\n SELECT\n   COUNT(DISTINCT payment_type)\nFROM\n    OPENROWSET(\n        BULK 'trip_data_green_delta/',\n        DATA_SOURCE = 'nyc_taxi_data_raw',\n        FORMAT = 'DELTA'\n    )AS [result]  \n    WHERE year = '2020'   AND month = '01'\n\n\n\n-------------------------------------------\n-- Wild Card Chanracters in the File Name  : Not Valid in DELTA as you can't query folders and subfloders\n-------------------------------------------\n/*\nSELECT\n    COUNT(1) -- 447770\nFROM\n    OPENROWSET(\n        BULK 'trip_data_green_parquet/year=2020/month=01/*.parquet',\n        DATA_SOURCE = 'nyc_taxi_data_raw',\n        FORMAT = 'PARQUET'\n    )WITH(    \n     tip_amount\tfloat    \n    ,trip_type\tint\n    ) AS [result]    \n\n-------------------------------------------\n-- All Parquet Files   : Not Valid in DELTA as you can't query folders and subfloders\n-------------------------------------------\nSELECT\n    COUNT(1) -- 2304517\nFROM\n    OPENROWSET(\n        BULK 'trip_data_green_parquet/**',\n        DATA_SOURCE = 'nyc_taxi_data_raw',\n        FORMAT = 'PARQUET'\n    )WITH(    \n     tip_amount\tfloat    \n    ,trip_type\tint\n    ) AS [result]    \n\n-------------------------------------------\n-- All Parquet Files in Year =2020  : Not Valid in DELTA as you can't query folders and subfloders\n-------------------------------------------\nSELECT\n    COUNT(1) -- 1734051\nFROM\n    OPENROWSET(\n        BULK 'trip_data_green_parquet/year=2020/**',\n        DATA_SOURCE = 'nyc_taxi_data_raw',\n        FORMAT = 'PARQUET'\n    )WITH(    \n     tip_amount\tfloat    \n    ,trip_type\tint\n    ) AS [result]    \n*/\n-------------------------------------------\n-- All Parquet Files in Year =2020 and Month = Any  : Not Valid in DELTA as you can't query folders and subfloders\n-------------------------------------------\n-- SELECT \n--     COUNT(1) -- 1734051\n-- FROM\n--     OPENROWSET(\n--         BULK 'trip_data_green_parquet/year=2020/month=*/',\n--         DATA_SOURCE = 'nyc_taxi_data_raw',\n--         FORMAT = 'PARQUET'\n--     )WITH(    \n--      tip_amount\tfloat    \n--     ,trip_type\tint\n--     ) AS [result]    \n\n-------------------------------------------\n-- filename()  : Not Valid in DELTA as you can't query folders and subfloders\n-------------------------------------------\n-- SELECT \n--     result.filename() as file_name\n--     ,COUNT(1) AS file_record_count\n-- FROM\n--     OPENROWSET(\n--         BULK 'trip_data_green_parquet/year=2020/month=*/',\n--         DATA_SOURCE = 'nyc_taxi_data_raw',\n--         FORMAT = 'PARQUET'\n--     )WITH(    \n--      tip_amount\tfloat    \n--     ,trip_type\tint\n--     ) AS [result]   \n--     GROUP BY result.filename() \n\n\n-------------------------------------------\n-- filepath() and All Files recursively  : Not Valid in DELTA as you can't query folders and subfloders\n-------------------------------------------\n-- SELECT \n--     result.filename() as file_name\n--     ,result.filepath() as file_path\n--     ,COUNT(1) AS file_record_count\n-- FROM\n--     OPENROWSET(\n--         BULK 'trip_data_green_parquet/**',\n--         DATA_SOURCE = 'nyc_taxi_data_raw',\n--         FORMAT = 'PARQUET'\n--     )WITH(    \n--      tip_amount\tfloat    \n--     ,trip_type\tint\n--     ) AS [result]   \n--     GROUP BY result.filepath(),result.filename() \n\n-------------------------------------------\n-- filepath() filters  : Not Valid in DELTA as you can't query folders and subfloders\n-------------------------------------------\n\n-- SELECT \n--     result.filename() as file_name\n--     ,result.filepath() as file_path\n--     ,result.filepath(1) as Year\n--     ,result.filepath(2) as Month\n--     ,COUNT(1) AS file_record_count\n-- FROM\n--     OPENROWSET(\n--         BULK 'trip_data_green_parquet/year=*/month=*/',\n--         DATA_SOURCE = 'nyc_taxi_data_raw',\n--         FORMAT = 'PARQUET'\n--     )WITH(    \n--      tip_amount\tfloat    \n--     ,trip_type\tint\n--     ) AS [result]\n--     WHERE  result.filepath(1) = '2020'\n--     AND result.filepath(2) IN ('06','07','08')\n--     GROUP BY result.filepath(),result.filepath(1),result.filepath(2),result.filename() \n\n              \n   \n\n\n\n\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "nyc_taxi_discovery",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}
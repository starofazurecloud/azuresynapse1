{
	"name": "14_Create_Gold_Trip_Data_Green",
	"properties": {
		"folder": {
			"name": "1_NYC_Taxi/2_ldw"
		},
		"content": {
			"query": "USE nyc_taxi_ldw;\nGO\n\n-- Assignment 1\n\n/*\nSELECT \n        td.year\n       ,td.month\n       ,tz.borough\n       ,CONVERT(DATE,td.lpep_pickup_datetime) AS trip_date\n      ,cal.day_name  AS trip_day\n      ,iif(cal.day_name IN ('Saturday','Sunday'),'Y','N') AS trip_day_weekend_ind\n      ,SUM(iif(pt.description = 'Credit card',1,0)) AS card_trip_count\n      ,SUM(iif(pt.description = 'Cash',1,0)) AS cash_trip_count\nFROM silver.vw_trip_data_green td\nINNER JOIN silver.taxi_zone tz ON (td.pu_location_id = tz.loation_id)\nINNER JOIN silver.calendar cal ON (cal.date = CONVERT(DATE,td.lpep_pickup_datetime))\nINNER JOIN silver.payment_type pt ON (td.payment_type = pt.payment_type)\n\nWHERE td.year = '2020'\n  AND td.month = '01'\n\nGROUP BY td.year\n        ,td.month\n        ,tz.borough\n        ,CONVERT(DATE,td.lpep_pickup_datetime) \n       ,cal.day_name \n\n*/\n\nEXEC gold.usp_gold_trip_data_green @year = '2020' , @month = '01'\nEXEC gold.usp_gold_trip_data_green @year = '2020' , @month = '02'\nEXEC gold.usp_gold_trip_data_green @year = '2020' , @month = '03'\nEXEC gold.usp_gold_trip_data_green @year = '2020' , @month = '04'\nEXEC gold.usp_gold_trip_data_green @year = '2020' , @month = '05'\nEXEC gold.usp_gold_trip_data_green @year = '2020' , @month = '06'\nEXEC gold.usp_gold_trip_data_green @year = '2020' , @month = '07'\nEXEC gold.usp_gold_trip_data_green @year = '2020' , @month = '08'\nEXEC gold.usp_gold_trip_data_green @year = '2020' , @month = '09'\nEXEC gold.usp_gold_trip_data_green @year = '2020' , @month = '10'\nEXEC gold.usp_gold_trip_data_green @year = '2020' , @month = '11'\nEXEC gold.usp_gold_trip_data_green @year = '2020' , @month = '12'\n\nEXEC gold.usp_gold_trip_data_green @year = '2021' , @month = '01'\nEXEC gold.usp_gold_trip_data_green @year = '2021' , @month = '02'\nEXEC gold.usp_gold_trip_data_green @year = '2021' , @month = '03'\nEXEC gold.usp_gold_trip_data_green @year = '2021' , @month = '04'\nEXEC gold.usp_gold_trip_data_green @year = '2021' , @month = '05'\nEXEC gold.usp_gold_trip_data_green @year = '2021' , @month = '06'\n\n\n/*\n\nEXEC sp_describe_first_result_set N'SELECT \n        td.year\n       ,td.month\n       ,tz.borough\n       ,CONVERT(DATE,td.lpep_pickup_datetime) AS trip_date\n      ,cal.day_name  AS trip_day\n      ,iif(cal.day_name IN (''Saturday'',''Sunday''),''Y'',''N'') AS trip_day_weekend_ind\n      ,SUM(iif(pt.description = ''Credit card'',1,0)) AS card_trip_count\n      ,SUM(iif(pt.description = ''Cash'',1,0)) AS cash_trip_count\nFROM silver.vw_trip_data_green td\nINNER JOIN silver.taxi_zone tz ON (td.pu_location_id = tz.loation_id)\nINNER JOIN silver.calendar cal ON (cal.date = CONVERT(DATE,td.lpep_pickup_datetime))\nINNER JOIN silver.payment_type pt ON (td.payment_type = pt.payment_type)\n\nWHERE td.year = ''2020''\n  AND td.month = ''01''\n\nGROUP BY td.year\n        ,td.month\n        ,tz.borough\n        ,CONVERT(DATE,td.lpep_pickup_datetime) \n       ,cal.day_name'\n\n*/\n\n\n\n-- Assignment 2\n\n\nSELECT \n        td.year\n       ,td.month\n       ,tz.borough\n       ,CONVERT(DATE,td.lpep_pickup_datetime) AS trip_date\n      ,cal.day_name  AS trip_day\n      ,iif(cal.day_name IN ('Saturday','Sunday'),'Y','N') AS trip_day_weekend_ind\n      ,SUM(iif(pt.description = 'Credit card',1,0)) AS card_trip_count\n      ,SUM(iif(pt.description = 'Cash',1,0)) AS cash_trip_count\n      ,SUM(IIF(tt.trip_type_desc='Street-hail',1,0)) AS Street_hail_trip_count\n      ,SUM(IIF(tt.trip_type_desc='Dispatch',1,0)) AS Dispatch_hail_trip_count\n      ,SUM(td.trip_distance) AS trip_distance\n      ,SUM(DATEDIFF(MINUTE,td.lpep_pickup_datetime,td.lpep_dropoff_datetime)) AS trip_duration\n      ,SUM(td.fare_amount) AS fare_amount\nFROM silver.vw_trip_data_green td\nINNER JOIN silver.taxi_zone tz ON (td.pu_location_id = tz.loation_id)\nINNER JOIN silver.calendar cal ON (cal.date = CONVERT(DATE,td.lpep_pickup_datetime))\nINNER JOIN silver.payment_type pt ON (td.payment_type = pt.payment_type)\nINNER JOIN silver.trip_type tt ON (td.trip_type = tt.trip_type)\n\nWHERE td.year = '2020'\n  AND td.month = '01'\n\nGROUP BY td.year\n        ,td.month\n        ,tz.borough\n        ,CONVERT(DATE,td.lpep_pickup_datetime) \n       ,cal.day_name \n\n\n\nselect * from  silver.trip_type\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "nyc_taxi_ldw",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}
{
	"name": "4_Create_External_Tables",
	"properties": {
		"folder": {
			"name": "1_NYC_Taxi/2_ldw"
		},
		"content": {
			"query": "USE nyc_taxi_ldw;\nGO\n\n----------------------------------------\n-- External Table Name :  bronze.taxi_zone\n----------------------------------------\n\nIF EXISTS (SELECT 1 FROM sys.external_tables WHERE name = 'taxi_zone')\n    DROP EXTERNAL TABLE bronze.taxi_zone\n\n-- or\n--IF OBJECT_ID('bronze.taxi_zone') IS NOT NULL\n--DROP EXTERNAL TABLE bronze.taxi_zone\n\nGO\n\nCREATE EXTERNAL TABLE  nyc_taxi_ldw.bronze.taxi_zone\n    ( loation_id SMALLINT ,\n    borough VARCHAR(15)   ,\n    zone VARCHAR(50)   ,\n    service_zone VARCHAR(15)   )\n    WITH (\n        LOCATION = 'raw/taxi_zone.csv',\n        DATA_SOURCE = nyc_taxi_src,\n        FILE_FORMAT = csv_file_format,\n        --FILE_FORMAT = csv_file_format_pv1, -- To Show the error Lines\n        REJECT_VALUE = 10 ,\n        REJECTED_ROW_LOCATION = 'rejections/taxi_zone'\n         \n    );\n\n\nGO\n\nSELECT TOP 100 * FROM nyc_taxi_ldw.bronze.taxi_zone\n\n----------------------------------------\n-- To Demonstrate Error Handling Mechanism\n----------------------------------------\n\nIF OBJECT_ID('bronze.taxi_zone_error') IS NOT NULL\n    DROP EXTERNAL TABLE bronze.taxi_zone_error\n\nGO\n\nCREATE EXTERNAL TABLE  nyc_taxi_ldw.bronze.taxi_zone_error\n    ( loation_id SMALLINT ,\n    borough VARCHAR(8)   , -- Changed from 15 to 1\n    zone VARCHAR(50)   ,\n    service_zone VARCHAR(15)   )\n    WITH (\n        LOCATION = 'raw/taxi_zone.csv',\n        DATA_SOURCE = nyc_taxi_src,\n        FILE_FORMAT = csv_file_format_pv1, -- To Show the error Lines .\n        REJECT_VALUE = 10 ,\n        REJECTED_ROW_LOCATION = 'rejections/taxi_zone'\n         \n    );\n\nGO\n\nSELECT TOP 100 * FROM nyc_taxi_ldw.bronze.taxi_zone_error\n\n\n\n----------------------------------------\n-- External Table Name : bronze.calendar\n----------------------------------------\n\nIF OBJECT_ID('bronze.calendar') IS NOT NULL\n    DROP EXTERNAL TABLE bronze.calendar\n\nGO\n\nCREATE EXTERNAL TABLE  nyc_taxi_ldw.bronze.calendar\n    (    date_key   INT \n        ,date       DATE \n        ,year       INT \n        ,month      SMALLINT \n        ,day        SMALLINT \n        ,day_name   VARCHAR(15) \n        ,day_of_year    SMALLINT \n        ,week_of_month  SMALLINT \n        ,week_of_year   SMALLINT \n        ,month_name     VARCHAR(15) \n        ,year_month     INT \n        ,year_week      INT \n )\n    WITH (\n        LOCATION = 'raw/calendar.csv',\n        DATA_SOURCE = nyc_taxi_src,\n        FILE_FORMAT = csv_file_format, \n        REJECT_VALUE = 10 ,\n        REJECTED_ROW_LOCATION = 'rejections/calendar'\n         \n    );\n\nGO\n\nSELECT TOP 100 * FROM nyc_taxi_ldw.bronze.calendar\n\n\n----------------------------------------\n-- External Table Name : bronze.vendor\n----------------------------------------\n\nIF OBJECT_ID('bronze.vendor') IS NOT NULL\n    DROP EXTERNAL TABLE bronze.vendor\n\nGO\n\nCREATE EXTERNAL TABLE  nyc_taxi_ldw.bronze.vendor\n    (    vendor_id TINYINT ,\n        vendor_name VARCHAR(100) \n )\n    WITH (\n        LOCATION = 'raw/vendor.csv',\n        DATA_SOURCE = nyc_taxi_src,\n        FILE_FORMAT = csv_file_format, \n        REJECT_VALUE = 10 ,\n        REJECTED_ROW_LOCATION = 'rejections/vendor'\n         \n    );\n\nGO\n\nSELECT TOP 100 * FROM nyc_taxi_ldw.bronze.vendor\n\n\n----------------------------------------\n-- External Table Name : bronze.trip_type\n----------------------------------------\n\nIF OBJECT_ID('bronze.trip_type') IS NOT NULL\n    DROP EXTERNAL TABLE bronze.trip_type\nGO\n\nCREATE EXTERNAL TABLE  nyc_taxi_ldw.bronze.trip_type\n    (    trip_type SMALLINT ,\n         trip_type_desc VARCHAR(30) \n )\n    WITH (\n        LOCATION = 'raw/trip_type.tsv',\n        DATA_SOURCE = nyc_taxi_src,\n        FILE_FORMAT = tsv_file_format, \n        REJECT_VALUE = 10 ,\n        REJECTED_ROW_LOCATION = 'rejections/trip_type'\n         \n    );\n\nGO\n\nSELECT TOP 100 * FROM nyc_taxi_ldw.bronze.trip_type;\n\n----------------------------------------\n-- External Table Name : bronze.trip_data_green_parquet\n----------------------------------------\n\nIF OBJECT_ID('bronze.trip_data_green_csv') IS NOT NULL\n        DROP EXTERNAL TABLE bronze.trip_data_green_csv\nGO\n\nCREATE EXTERNAL TABLE  nyc_taxi_ldw.bronze.trip_data_green_csv\n    (    \n      VendorID\tint\n    ,lpep_pickup_datetime\tdatetime2(7)\n    ,lpep_dropoff_datetime\tdatetime2(7)\n    ,store_and_fwd_flag\tCHAR(1)\n    ,RatecodeID\tint\n    ,PULocationID\tint\n    ,DOLocationID\tint\n    ,passenger_count\tint\n    ,trip_distance\tfloat\n    ,fare_amount\tfloat\n    ,extra\tfloat\n    ,mta_tax\tfloat\n    ,tip_amount\tfloat\n    ,tolls_amount\tfloat\n    ,ehail_fee\tint\n    ,improvement_surcharge\tfloat\n    ,total_amount\tfloat\n    ,payment_type\tint\n    ,trip_type\tint\n    ,congestion_surcharge\tfloat\n    ,year VARCHAR(4)\n    ,month VARCHAR(2) \n )\n    WITH (\n        LOCATION = 'raw/trip_data_green_csv/**',  -- OR\n        --LOCATION = 'raw/trip_data_green_csv/year=*/month=*/*.csv',\n        DATA_SOURCE = nyc_taxi_src,\n        FILE_FORMAT = csv_file_format, \n        REJECT_VALUE = 10 ,\n        REJECTED_ROW_LOCATION = 'rejections/trip_data_green_csv'\n         \n    );\n\nGO\n\nSELECT TOP 100 * FROM nyc_taxi_ldw.bronze.trip_data_green_csv;\n\n\n\n----------------------------------------------------------\n-- External Table Name : bronze.trip_data_green_parquet\n----------------------------------------------------------\n\nIF OBJECT_ID('bronze.trip_data_green_parquet') IS NOT NULL\n        DROP EXTERNAL TABLE bronze.trip_data_green_parquet\nGO\n\nCREATE EXTERNAL TABLE  nyc_taxi_ldw.bronze.trip_data_green_parquet\n    (    \n      VendorID\tint\n    ,lpep_pickup_datetime\tdatetime2(7)\n    ,lpep_dropoff_datetime\tdatetime2(7)\n    ,store_and_fwd_flag\tCHAR(1)\n    ,RatecodeID\tint\n    ,PULocationID\tint\n    ,DOLocationID\tint\n    ,passenger_count\tint\n    ,trip_distance\tfloat\n    ,fare_amount\tfloat\n    ,extra\tfloat\n    ,mta_tax\tfloat\n    ,tip_amount\tfloat\n    ,tolls_amount\tfloat\n    ,ehail_fee\tint\n    ,improvement_surcharge\tfloat\n    ,total_amount\tfloat\n    ,payment_type\tint\n    ,trip_type\tint\n    ,congestion_surcharge\tfloat\n    ,year VARCHAR(4)\n    ,month VARCHAR(2) \n )\n    WITH (\n        LOCATION = 'raw/trip_data_green_parquet/**',  -- OR\n        --LOCATION = 'raw/trip_data_green_parquet/year=*/month=*/*.parquet',\n        DATA_SOURCE = nyc_taxi_src,\n        FILE_FORMAT = parquet_file_format, \n        REJECT_VALUE = 10 ,\n        REJECTED_ROW_LOCATION = 'rejections/trip_data_green_parquet'\n         \n    );\n\nGO\n\nSELECT TOP 100 * FROM nyc_taxi_ldw.bronze.trip_data_green_parquet;\n\n\n\n----------------------------------------------------------\n-- External Table Name : bronze.trip_data_green_delta\n----------------------------------------------------------\n\nIF OBJECT_ID('bronze.trip_data_green_delta') IS NOT NULL\n        DROP EXTERNAL TABLE bronze.trip_data_green_delta\nGO\n\nCREATE EXTERNAL TABLE  nyc_taxi_ldw.bronze.trip_data_green_delta\n    (    \n      VendorID\tint\n    ,lpep_pickup_datetime\tdatetime2(7)\n    ,lpep_dropoff_datetime\tdatetime2(7)\n    ,store_and_fwd_flag\tCHAR(1)\n    ,RatecodeID\tint\n    ,PULocationID\tint\n    ,DOLocationID\tint\n    ,passenger_count\tint\n    ,trip_distance\tfloat\n    ,fare_amount\tfloat\n    ,extra\tfloat\n    ,mta_tax\tfloat\n    ,tip_amount\tfloat\n    ,tolls_amount\tfloat\n    ,ehail_fee\tint\n    ,improvement_surcharge\tfloat\n    ,total_amount\tfloat\n    ,payment_type\tint\n    ,trip_type\tint\n    ,congestion_surcharge\tfloat\n    ,year VARCHAR(4)\n    ,month VARCHAR(2) \n )\n    WITH (\n        LOCATION = 'raw/trip_data_green_delta/',\n        DATA_SOURCE = nyc_taxi_src,\n        FILE_FORMAT = delta_file_format\n         \n    );\n\nGO\n\nSELECT TOP 100 * FROM nyc_taxi_ldw.bronze.trip_data_green_delta;\n\n\n\n\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "nyc_taxi_ldw",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}